<!DOCTYPE html>
<html>
  <head>
    <title>Integration Testing</title>

    <style type="text/css">
        canvas { width: 100%; height: 100%; }
    </style>

  </head>
  <body>
    <canvas id="canvas" width="1280" height="720"></canvas>

    <script src="lib/glitchlib.js"></script>

    <script type="text/javascript">
      var canvas = document.getElementById('canvas');
      ctx = canvas.getContext('2d');

      var img1 = new Image();

      img1.onload = function () {
          ctx.drawImage(img1, 0, 0);
      };

      img1.src = 'testcard.jpg';

      function fileToUint8(event) {
        var imgdata = new Uint8Array(event.target.result);
        var sections = glitchlib.decodeJpeg(imgdata);
        var data = {
          imgdata: imgdata,
          sections: sections
        }
        window.data = data;
      }

      function parseCanvas() {
        canvas.toBlob(function (blob) {
          var r = new FileReader();

          r.onload = fileToUint8;

          r.readAsArrayBuffer(blob);
        }, 'image/jpeg', 0.95);
      }

      function loadGlitchedImage() {
        var objurl = window.URL.createObjectURL(new Blob([window.data.imgdata], {type: 'image/jpeg'}));
        var glitchedImg = new Image();
        glitchedImg.src = objurl;
        glitchedImg.onload = function () {
          console.log('image loading');
          ctx.drawImage(glitchedImg, 0, 0);
        }
      }

    </script>

  </body>
</html>
